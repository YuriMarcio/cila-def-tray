<div  class="product{{ product.has_other_prices ? ' has-other-prices' }}tw-min-w-242  lg:tw-min-w-0 lg:tw-max-w-305 tw-cursor-pointer tw-bg-white tw-mt-16 tw-mb-4 tw-ml-4" itemid="{{product.id}}">
    <a class="link" href="{{ settings.buy_to_cart ? links.cart_add ~ product.id : product.link }}" data-tray-tst="vitrine_produto_link_imagem">
        <div class="product-image" class="tw-relative">
            {% if product.images %}
            <div class="control">
                    <img itemprop="image" class="lazy pc0 tw-bg-white " src="{{ product.images[0].full }}" alt="{{ product.name }}" title="{{ product.name }}">
                    {% if settings.image_list and product.images[1] and (not utils.is_mobile) %}
                        <img itemprop="image" class="lazy pc0 tw-bg-white " src="{{ product.images[0].full }}" alt="{{ product.name }}" title="{{ product.name }}">
                    {% else %}
                        <img itemprop="image"  data-original="{{ product.images[1].full }}" class="lazy pc1 tw-absolute  " 
                        src="{{ product.images[1].full }}" alt="{{ product.name }}" title="{{ product.name }}">
                    {% endif %}
                {% else %}
                    <img src="{{ asset('img/no-image.svg') }}" alt="Nenhuma imagem foi cadastrada" width="100" title="{{ product.name }}">
                {% endif %}
            </div>             
        </div>   
        <section id="description" class="tw-text-black  tw-text-2xl tw-pt-7">
            {% if settings.discount %}
            {% set porcentagemDesconto = 100 - ( product.price_offer / product.price ) * 100 %}
                {% if porcentagemDesconto < 100 %}
                <span class="discount tw-text-xl "> {{ porcentagemDesconto|number_format }}% de desconto </span>
            {% endif %}  
            {% endif %} 
            <div class="product-name text-secondary-theme mt-3" itemprop="name">{{ product.name }}</div>
            <meta itemprop="productID" content="{{ product.id }}"/>
            <meta itemprop="sku" content="{{ product.id }}"/>
            {% if product.ean %}
                <meta itemprop="gtin14" content="{{ product.ean }}">
            {% endif %}
            
            {% if product.description_small %}
                <meta itemprop="description" content="{{ product.description_small }}">
            {% endif %}

            
            {% if product.brand %}
            <span itemprop="brand" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="{{ product.brand }}"/>
            </span>
            {% endif %} 


            {% for discount in product.ProgressiveDiscounts %}
            {% if discount.tag %}
                <div class="product-discount-recursive-tag">{{discount.tag}}</div>
                <div class="product-discount-recursive-desc">{{discount.description}}</div>
            {% endif %}
        {% endfor %} 
        
            {% if settings.cache_infopreco %}
            <div data-module="pricing" data-snippet="snippets/product-payment" data-product-id="{{ product.id }}">
                <div class="pricing">
                    Carregando...
                </div>
            </div>
            {% else %}
                {% element 'snippets/product-payment' {"product": product } %}
            {% endif %}
       </section>
    </a>
       <section>
        {% if product.available and (product.stock > 0 or settings.without_stock_sale) and not product.upon_request %}
    <div class="variants">

        {% set productVar = product.Variants|length ? product.Variants :  product.variants %}
        {% set listVariants = [] %}
        {% set listVariantsSecond = [] %}
        {% set variants = [] %}
        {% set variantName = '' %}
        {% set variantSecondName = '' %}

        {% for variant in productVar %}

            {% if loop.index == 1 %}

                {% if variant.Sku[1] %}
                    {% set variantSecondName = variant.Sku[1].type %}
                {% endif %}
                {% set variantName = variant.Sku[0].type %}

            {% endif %}

            {% set stock = variant.stock %}

            {% if variant.id|length == '0' %}

                {% set variants = '' %}

            {% elseif variant.Sku[1] %}

                {% set variants = variants|merge([{ "price": {"price": variant.price_offer != 0 ? variant.price_offer : variant.price, "payment": variant.payment_option }, "id": variant.id, "stock": stock, "option": variant.Sku[0].value|convert_encoding('UTF-8', 'ISO-8859-1'), "option2": variant.Sku[1].value|convert_encoding('UTF-8', 'ISO-8859-1') }]) %}

                {% set valueSecond = variant.Sku[1].value %}
                {% if not (valueSecond in listVariantsSecond) %}
                    {% set listVariantsSecond = listVariantsSecond|merge([valueSecond]) %}
                {% endif %}

            {% else %}

                {% set variants = variants|merge([{ "price": {"price": variant.price_offer != 0 ? variant.price_offer : variant.price, "payment": variant.payment_option }, "id": variant.id, "stock": stock, "option": variant.Sku[0].value|convert_encoding('UTF-8', 'ISO-8859-1'),"image": variant.image, }]) %}

            {% endif %}

            {% set value = variant.Sku[0].value %}
            {% set image = variant.image %}
            {% if not (value in listVariants) %}
                {% set listVariants = listVariants|merge([value]) %}
            {% endif %}
            {% if not (image in listVariants) %}
                {% set listVariants = listVariants|merge([image]) %}
            {% endif %}

        {% endfor %}

        <form class="list-variants" data-id="{{ product.id }}" data-variants='{{ variants ? variants|json_encode : "" }}' data-api-cart="1" >
            <div class="set tw-py-4">
                {% if variantName %}
                <label>
                    <div class="first tw-flex" required>
                        <div class="val"> <img src="{{ image }}" alt=""></div>
                    </div>
                </label>
                {% endif %}
    
                {% if variantSecondName %}
                <label>
                    <div class="second tw-flex" required>
                        {% for value in listVariantsSecond %}
                        <input class="inpval " data-price="{{ price }}" value="{{value}}" id="{{ product.id }}" type="checkbox" >
                        <div class="val"> {{ value }}</div>
                        {% endfor %}
                    </div>
                </label>
                {% endif %}
            </div>
            <div class="flex add-cart">
                <input required type="number" value="1" class="tw-hidden">
                <button class="action">Adicionar ao carrinho</button>
            </div>
        </form>

    </div>
{% endif %} 
       </section>

</div>